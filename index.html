<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>BetKing Міні-Додаток</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            padding: 15px;
            margin: 0;
            color: var(--tg-theme-text-color, #000000);
            background-color: var(--tg-theme-bg-color, #ffffff);
            overflow-x: hidden;
        }
        .container {
            text-align: center;
        }
        h1, h2 {
            color: var(--tg-theme-text-color, #000000);
        }
        h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        h2 {
            font-size: 20px;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        p {
            font-size: 16px;
            margin-bottom: 10px;
        }
        button, .odds-button, .stake-button, .action-button {
            padding: 10px 15px;
            font-size: 16px;
            color: var(--tg-theme-button-text-color, #ffffff);
            background-color: var(--tg-theme-button-color, #007bff);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            min-width: 80px;
        }
        .odds-button.selected {
            background-color: #FFE433;
            color: #000000;
        }
        .stake-options, .bet-confirmation {
            margin-top: 15px;
        }
        .hidden {
            display: none;
        }
        #userInfo {
            margin-top: 20px;
            font-size: 12px;
            color: var(--tg-theme-hint-color, #999999);
            word-break: break-all;
            padding-bottom: 20px;
        }
        .section-block {
            padding: 10px;
            border: 1px solid var(--tg-theme-hint-color, #dddddd);
            border-radius: 8px;
            margin-bottom: 15px;
            background-color: var(--tg-theme-secondary-bg-color, #f8f8f8);
        }
        .teams, .express-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .match-date, .express-total-odds {
            font-size: 14px;
            color: var(--tg-theme-hint-color, #777777);
            margin-bottom: 10px;
        }
        .odds-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom:10px;
        }
        .express-selections {
            list-style: none;
            padding-left: 0;
            text-align: left;
            font-size: 14px;
        }
        .express-selections li {
            padding: 5px 0;
            border-bottom: 1px dashed var(--tg-theme-hint-color, #eeeeee);
        }
        .express-selections li:last-child {
            border-bottom: none;
        }
        hr.section-divider {
            margin-top: 30px;
            margin-bottom: 10px;
            border: none;
            border-top: 1px solid var(--tg-theme-hint-color, #cccccc);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Міні-Додаток BetKing</h1>

        <div id="matchOfTheDaySection">
            <h2>Матч дня</h2>
            <div class="section-block">
                <div id="matchTeams" class="teams"></div>
                <div id="matchDate" class="match-date"></div>
                <div id="oddsContainer" class="odds-container"></div>
            </div>
            <div id="motdStakeOptions" class="stake-options hidden">
                <p>Оберіть суму ставки для Матчу дня:</p>
                <button class="stake-button motd-stake" data-amount="100">100 грн</button>
                <button class="stake-button motd-stake" data-amount="200">200 грн</button>
                <button class="stake-button motd-stake" data-amount="500">500 грн</button>
            </div>
            <div id="motdBetConfirmation" class="bet-confirmation"></div>
        </div>

        <hr class="section-divider">

        <div id="expressOfTheDaySection">
            <h2>Експрес дня</h2>
            <div class="section-block">
                <div id="expressTitle" class="express-title"></div>
                <ul id="expressSelections" class="express-selections"></ul>
                <div id="expressTotalOdds" class="express-total-odds"></div>
                <button id="acceptExpressButton" class="action-button">Поставити на цей Експрес</button>
            </div>
            <div id="eotdStakeOptions" class="stake-options hidden">
                <p>Оберіть суму ставки для Експресу дня:</p>
                <button class="stake-button eotd-stake" data-amount="100">100 грн</button>
                <button class="stake-button eotd-stake" data-amount="200">200 грн</button>
                <button class="stake-button eotd-stake" data-amount="500">500 грн</button>
            </div>
            <div id="eotdBetConfirmation" class="bet-confirmation"></div>
        </div>

        <hr class="section-divider">
        <div id="userInfo"></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        if (tg.themeParams.secondary_bg_color) {
            tg.setHeaderColor(tg.themeParams.secondary_bg_color);
        } else if (tg.themeParams.bg_color) {
             tg.setHeaderColor(tg.themeParams.bg_color);
        }

        // --- Дані для Матчу дня (поки що статичні) ---
        const matchOfTheDayData = {
            team1: "Динамо Київ",
            team2: "Шахтар Донецьк",
            date: "12 Травня 2025, 19:00",
            odds: {
                p1: { name: "П1", value: 2.50, description: "Перемога Динамо Київ" },
                x:  { name: "X", value: 3.20, description: "Нічия" },
                p2: { name: "П2", value: 2.80, description: "Перемога Шахтар Донецьк" }
            }
        };
        let motdSelectedOdd = null;

        // --- Дані для Експресу дня (поки що статичні) ---
        const expressOfTheDayData = {
            title: "Супер Експрес на Вихідні!",
            selections: [
                { description: "Манчестер Юнайтед - Перемога" },
                { description: "Барселона - ТБ 2.5" },
                { description: "Ювентус - Фора(0)" }
            ],
            totalOdds: 6.75
        };

        // --- Елементи DOM для Матчу дня ---
        const matchTeamsEl = document.getElementById('matchTeams');
        const matchDateEl = document.getElementById('matchDate');
        const oddsContainerEl = document.getElementById('oddsContainer');
        const motdStakeOptionsEl = document.getElementById('motdStakeOptions');
        const motdBetConfirmationEl = document.getElementById('motdBetConfirmation');

        // --- Елементи DOM для Експресу дня ---
        const expressTitleEl = document.getElementById('expressTitle');
        const expressSelectionsEl = document.getElementById('expressSelections');
        const expressTotalOddsEl = document.getElementById('expressTotalOdds');
        const acceptExpressButton = document.getElementById('acceptExpressButton');
        const eotdStakeOptionsEl = document.getElementById('eotdStakeOptions');
        const eotdBetConfirmationEl = document.getElementById('eotdBetConfirmation');

        // --- Загальний елемент DOM ---
        const userInfoDiv = document.getElementById('userInfo');

        // --- Функція для відображення Матчу дня ---
        function displayMatchOfTheDay() {
            matchTeamsEl.textContent = `${matchOfTheDayData.team1} - ${matchOfTheDayData.team2}`;
            matchDateEl.textContent = matchOfTheDayData.date;
            oddsContainerEl.innerHTML = '';
            for (const key in matchOfTheDayData.odds) {
                const odd = matchOfTheDayData.odds[key];
                const button = document.createElement('button');
                button.className = 'odds-button';
                button.dataset.key = key;
                button.innerHTML = `${odd.name}<br>${odd.value.toFixed(2)}`;
                button.addEventListener('click', handleMotdOddSelection);
                oddsContainerEl.appendChild(button);
            }
        }

        function handleMotdOddSelection(event) {
            document.querySelectorAll('#oddsContainer .odds-button').forEach(btn => btn.classList.remove('selected'));
            const selectedButton = event.currentTarget;
            selectedButton.classList.add('selected');
            const oddKey = selectedButton.dataset.key;
            motdSelectedOdd = matchOfTheDayData.odds[oddKey];
            motdStakeOptionsEl.classList.remove('hidden');
            motdBetConfirmationEl.textContent = '';
        }

        document.querySelectorAll('.motd-stake').forEach(button => {
            button.addEventListener('click', function() {
                if (!motdSelectedOdd) {
                    tg.showAlert('Будь ласка, спочатку оберіть результат матчу дня!');
                    return;
                }
                const amount = parseInt(this.dataset.amount);
                const potentialWin = (amount * motdSelectedOdd.value).toFixed(2);
                const confirmationMessage = `Матч дня: Вашу ставку на "${motdSelectedOdd.description}" (${motdSelectedOdd.name} @${motdSelectedOdd.value.toFixed(2)}) на суму ${amount} грн прийнято (MVP).\nМожливий виграш: ${potentialWin} грн.`;
                motdBetConfirmationEl.textContent = confirmationMessage;
                
                tg.HapticFeedback.notificationOccurred('success'); // Вібровідгук

                // Запускаємо конфеті, якщо бібліотека завантажена
                if (typeof confetti === 'function') {
                    confetti({
                        particleCount: 120, // Кількість частинок
                        spread: 80,      // Розкид
                        origin: { y: 0.6 } // Початкова точка по вертикалі (0 - верх, 1 - низ)
                    });
                }

                motdStakeOptionsEl.classList.add('hidden');
                document.querySelectorAll('#oddsContainer .odds-button').forEach(btn => btn.classList.remove('selected'));
                motdSelectedOdd = null;
            });
        });

        // --- Функція для відображення Експресу дня ---
        function displayExpressOfTheDay() {
            expressTitleEl.textContent = expressOfTheDayData.title;
            expressSelectionsEl.innerHTML = ''; 
            expressOfTheDayData.selections.forEach(selection => {
                const listItem = document.createElement('li');
                listItem.textContent = selection.description;
                expressSelectionsEl.appendChild(listItem);
            });
            expressTotalOddsEl.textContent = `Загальний коефіцієнт: ${expressOfTheDayData.totalOdds.toFixed(2)}`;
        }

        acceptExpressButton.addEventListener('click', function() {
            eotdStakeOptionsEl.classList.remove('hidden');
            eotdBetConfirmationEl.textContent = '';
        });

        document.querySelectorAll('.eotd-stake').forEach(button => {
            button.addEventListener('click', function() {
                const amount = parseInt(this.dataset.amount);
                const potentialWin = (amount * expressOfTheDayData.totalOdds).toFixed(2);
                const confirmationMessage = `Експрес дня: Вашу ставку з коеф. ${expressOfTheDayData.totalOdds.toFixed(2)} на суму ${amount} грн прийнято (MVP).\nМожливий виграш: ${potentialWin} грн.`;
                eotdBetConfirmationEl.textContent = confirmationMessage;
                
                tg.HapticFeedback.notificationOccurred('success'); // Вібровідгук

                // Запускаємо конфеті, якщо бібліотека завантажена
                if (typeof confetti === 'function') {
                    confetti({
                        particleCount: 120,
                        spread: 80,
                        origin: { y: 0.6 },
                        zIndex: 9999 // Щоб конфеті було поверх інших елементів
                    });
                }
                
                eotdStakeOptionsEl.classList.add('hidden');
            });
        });

        // --- Відображення інформації про користувача ---
        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
            const user = tg.initDataUnsafe.user;
            let userInfoText = `Користувач: ${user.first_name || ''} ${user.last_name || ''} (@${user.username || 'N/A'}, ID: ${user.id})`;
            userInfoDiv.innerHTML = userInfoText;
        } else {
            userInfoDiv.textContent = "Дані користувача Telegram недоступні.";
        }

        // --- Ініціалізація ---
        displayMatchOfTheDay();
        displayExpressOfTheDay();

    </script>
</body>
</html>